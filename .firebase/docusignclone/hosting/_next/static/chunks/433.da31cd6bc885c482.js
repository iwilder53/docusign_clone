(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[433],{1563:function(e,n,t){"use strict";t.d(n,{N9:function(){return w},auth:function(){return l},$2:function(){return h},HP:function(){return x},HY:function(){return y},qj:function(){return g},tO:function(){return d},u_:function(){return m}});var i=t(738),o=t(4752),r=t(5978),a=t(62);t(2495);let c=async(e,n)=>{try{let t=window.Core,i=window.Core.PDFNet;console.log(i),t.setWorkerPath("webviewer/lib/core");let o=d.ref(),r=await o.child(e).getDownloadURL(),a=async()=>{let t;let a=await i.PDFDoc.createFromURL(r);for(a.initSecurityHandler(),t=0;t<n.length;t++){console.log(n[t]);let e=await i.FDFDoc.createFromXFDF(n[t]);await a.fdfMerge(e),await a.flattenAnnotations()}let c=await a.saveMemoryBuffer(i.SDFDoc.SaveOptions.e_linearized),s=new Blob([c],{type:"application/pdf"});o.child(e).put(s).then(function(e){console.log("Uploaded the blob")})};await i.runWithCleanup(a)}catch(e){console.error(e)}},s=(0,i.ZF)({apiKey:"AIzaSyAyDmBFLsYmknmeNghLz-Xw2wLIQSMNr48",authDomain:"docusignclone.firebaseapp.com",projectId:"docusignclone",storageBucket:"docusignclone.appspot.com",messagingSenderId:"491807205117",appId:"1:491807205117:web:76f35b9931e73f4e134094"}),l=(0,o.v0)(s),u=(0,r.ad)(s),d=(0,a.cF)(s),f=new o.hJ,g=async()=>{await (0,o.rh)(l,f)},h=async(e,n)=>{if(!e)return;let t=(0,r.JU)(u,"users/".concat(e.uid));if(!(await (0,r.QT)(t)).exists){let{email:i,displayName:o,photoURL:r}=e;try{await t.set({displayName:o,email:i,photoURL:r,...n})}catch(e){console.error("Error creating user document",e)}}return p(e.uid)},p=async e=>{if(!e)return null;try{let n=(0,r.JU)(u,"users",l.currentUser.uid),t=await (0,r.QT)(n);return{uid:e,...t.data()}}catch(e){console.error("Error fetching user",e)}},w=async(e,n,t,i)=>{if(!e)return;let o=new Date,a=(0,r.JU)(u,"documentsToSign",t.split("/")[1]);(0,r.pl)(a,{uid:e,email:n,docRef:t,emails:i,xfdf:[],signedBy:[],signed:!1,requestedTime:o,signedTime:""}).then(function(e){console.log("Document written with ID: ",e)}).catch(function(e){console.error("Error adding document: ",e)})},m=async(e,n,t)=>{let i=(0,r.JU)(u,"documentsToSign",e);(0,r.QT)(i).then(async e=>{if(e.exists){let{signedBy:o,emails:a,xfdf:s,docRef:l}=e.data();if(!o.includes(n)){let e=[...o,n],u=[...s,t];if(await (0,r.r7)(i,{xfdf:u,signedBy:e}),e.length===a.length){let e=new Date;await (0,r.r7)(i,{signed:!0,signedTime:e}),c(l,u)}}}else console.log("No such document!")}).catch(function(e){console.log("Error getting document:",e)})},x=async e=>{let n=(0,r.hJ)(u,"documentsToSign"),t=(0,r.IO)(n,(0,r.ar)("emails","array-contains",e),(0,r.ar)("signed","==",!1)),i=(0,r.IO)(n,(0,r.ar)("signedBy","array-contains",e)),o=[],a=[];return await (0,r.PL)(i).then(function(e){e.forEach(function(e){let n=e.id;a.push(n)})}).catch(function(e){console.log("Error getting documents: ",e)}),await (0,r.PL)(t).then(function(e){e.forEach(function(e){let{docRef:n,email:t,requestedTime:i}=e.data(),r=e.id;a.includes(r)||o.push({docRef:n,email:t,requestedTime:i,docId:r})})}).catch(function(e){console.log("Error getting documents: ",e)}),o},y=async e=>{let n=(0,r.hJ)(u,"documentsToSign"),t=[],i=(0,r.IO)(n,(0,r.ar)("email","==",e),(0,r.ar)("signed","==",!0));return await (0,r.PL)(i).then(function(e){e.forEach(function(e){let{docRef:n,emails:i,signedTime:o}=e.data(),r=e.id;t.push({docRef:n,emails:i,signedTime:o,docId:r})})}).catch(function(e){console.log("Error getting documents: ",e)}),t}},1561:function(e,n,t){"use strict";t.d(n,{av:function(){return o},dy:function(){return r}});let i=(0,t(5667).oM)({name:"firebase",initialState:{user:null,docs:[],docsSigned:[]},reducers:{setUser:(e,n)=>{e.user=n.payload}}}),{setUser:o}=i.actions,r=e=>e.firebase.user;n.ZP=i.reducer},2495:function(e,n,t){"use strict";let i=(0,t(5667).oM)({name:"MergeAnnotation",initialState:{pdfNet:null},reducers:{setInstance:(e,n)=>{e.pdfNet=n.payload},resetInstance:(e,n)=>{e.pdfNet=null}}}),{setInstance:o,resetInstance:r}=i.actions;n.ZP=i.reducer},433:function(e,n,t){"use strict";t.r(n);var i=t(7437),o=t(2265),r=t(4243),a=t(6017),c=t(9833),s=t(1563),l=t(1561),u=t(8378),d=t.n(u);t(2739),t(2683);var f=t(62),g=t(9376);t(2495),n.default=()=>{let[e,n]=(0,o.useState)(null),[t,u]=(0,o.useState)(0),h=(0,g.useRouter)(),p=(0,r.v9)(c.f5),w=(0,r.v9)(l.dy),{docRef:m,docId:x}=null!=p?p:"",{email:y}=w,b=(0,o.useRef)(null);(0,o.useEffect)(()=>{d()({path:"webviewer/lib",fullAPI:!0},b.current).then(async e=>{e.Core.PDFNet.initialize();let{documentViewer:t,annotationManager:i,Annotations:o}=e.Core;n(i),e.UI.setToolbarGroup("toolbarGroup-Insert");let r=(0,f.cF)();await (0,f.Jt)((0,f.iH)(r,m)).then(e=>{console.info(e),t.loadDocument(e)});let a=e=>e instanceof o.TextWidgetAnnotation?{"background-color":"#a5c7ff",color:"white"}:e instanceof o.SignatureWidgetAnnotation?{border:"1px solid #a5c7ff"}:void 0;i.addEventListener("annotationChanged",(e,n,t)=>{let{imported:i}=t;i&&"add"===n&&e.forEach(function(e){e instanceof o.WidgetAnnotation&&(o.WidgetAnnotation.getCustomStyles=a,e.fieldName.startsWith(y)||(e.Hidden=!0,e.Listable=!1))})})})},[m,y]);let S=async()=>{let n=await e.exportAnnotations({widgets:!1,links:!1});await (0,s.u_)(x,y,n),h.push("/")};return(0,i.jsx)("div",{className:"prepareDocument",children:(0,i.jsxs)(a.xu,{display:"flex",direction:"row",flex:"grow",children:[(0,i.jsxs)(a.sg,{span:2,children:[(0,i.jsx)(a.xu,{padding:3,children:(0,i.jsx)(a.X6,{size:"md",children:"Sign Document"})}),(0,i.jsx)(a.xu,{padding:3,children:(0,i.jsx)(a.X2,{gap:1,children:(0,i.jsxs)(a.Kq,{children:[(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsx)(a.zx,{onClick:()=>{let n=e.getAnnotationsList();n[t]&&(e.jumpToAnnotation(n[t]),n[t+1]&&u(t+1))},accessibilityLabel:"next field",text:"Next field",iconEnd:"arrow-forward"})}),(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsx)(a.zx,{onClick:()=>{let n=e.getAnnotationsList();n[t]&&(e.jumpToAnnotation(n[t]),n[t-1]&&u(t-1))},accessibilityLabel:"Previous field",text:"Previous field",iconEnd:"arrow-back"})}),(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsx)(a.zx,{onClick:S,accessibilityLabel:"complete signing",text:"Complete signing",iconEnd:"compose"})})]})})})]}),(0,i.jsx)(a.sg,{span:10,children:(0,i.jsx)("div",{className:"webviewer",ref:b})})]})})}},9833:function(e,n,t){"use strict";t.d(n,{Ak:function(){return o},GW:function(){return r},f5:function(){return a}});let i=(0,t(5667).oM)({name:"signDoc",initialState:{docToSign:null},reducers:{setDocToSign:(e,n)=>{e.docToSign=n.payload},resetDocToSign:(e,n)=>{e.docToSign=null}}}),{setDocToSign:o,resetDocToSign:r}=i.actions,a=e=>e.signDoc.docToSign;n.ZP=i.reducer},2683:function(){}}]);