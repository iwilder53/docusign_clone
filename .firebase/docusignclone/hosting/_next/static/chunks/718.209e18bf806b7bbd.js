(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[718],{1563:function(e,t,n){"use strict";n.d(t,{N9:function(){return m},auth:function(){return d},$2:function(){return p},HP:function(){return x},HY:function(){return y},qj:function(){return f},tO:function(){return u},u_:function(){return A}});var a=n(738),i=n(4752),o=n(5978),r=n(62);n(2495);let s=async(e,t)=>{try{let n=window.Core,a=window.Core.PDFNet;console.log(a),n.setWorkerPath("webviewer/lib/core");let i=u.ref(),o=await i.child(e).getDownloadURL(),r=async()=>{let n;let r=await a.PDFDoc.createFromURL(o);for(r.initSecurityHandler(),n=0;n<t.length;n++){console.log(t[n]);let e=await a.FDFDoc.createFromXFDF(t[n]);await r.fdfMerge(e),await r.flattenAnnotations()}let s=await r.saveMemoryBuffer(a.SDFDoc.SaveOptions.e_linearized),l=new Blob([s],{type:"application/pdf"});i.child(e).put(l).then(function(e){console.log("Uploaded the blob")})};await a.runWithCleanup(r)}catch(e){console.error(e)}},l=(0,a.ZF)({apiKey:"AIzaSyAyDmBFLsYmknmeNghLz-Xw2wLIQSMNr48",authDomain:"docusignclone.firebaseapp.com",projectId:"docusignclone",storageBucket:"docusignclone.appspot.com",messagingSenderId:"491807205117",appId:"1:491807205117:web:76f35b9931e73f4e134094"}),d=(0,i.v0)(l),c=(0,o.ad)(l),u=(0,r.cF)(l),g=new i.hJ,f=async()=>{await (0,i.rh)(d,g)},p=async(e,t)=>{if(!e)return;let n=(0,o.JU)(c,"users/".concat(e.uid));if(!(await (0,o.QT)(n)).exists){let{email:a,displayName:i,photoURL:o}=e;try{await n.set({displayName:i,email:a,photoURL:o,...t})}catch(e){console.error("Error creating user document",e)}}return h(e.uid)},h=async e=>{if(!e)return null;try{let t=(0,o.JU)(c,"users",d.currentUser.uid),n=await (0,o.QT)(t);return{uid:e,...n.data()}}catch(e){console.error("Error fetching user",e)}},m=async(e,t,n,a)=>{if(!e)return;let i=new Date,r=(0,o.JU)(c,"documentsToSign",n.split("/")[1]);(0,o.pl)(r,{uid:e,email:t,docRef:n,emails:a,xfdf:[],signedBy:[],signed:!1,requestedTime:i,signedTime:""}).then(function(e){console.log("Document written with ID: ",e)}).catch(function(e){console.error("Error adding document: ",e)})},A=async(e,t,n)=>{let a=(0,o.JU)(c,"documentsToSign",e);(0,o.QT)(a).then(async e=>{if(e.exists){let{signedBy:i,emails:r,xfdf:l,docRef:d}=e.data();if(!i.includes(t)){let e=[...i,t],c=[...l,n];if(await (0,o.r7)(a,{xfdf:c,signedBy:e}),e.length===r.length){let e=new Date;await (0,o.r7)(a,{signed:!0,signedTime:e}),s(d,c)}}}else console.log("No such document!")}).catch(function(e){console.log("Error getting document:",e)})},x=async e=>{let t=(0,o.hJ)(c,"documentsToSign"),n=(0,o.IO)(t,(0,o.ar)("emails","array-contains",e),(0,o.ar)("signed","==",!1)),a=(0,o.IO)(t,(0,o.ar)("signedBy","array-contains",e)),i=[],r=[];return await (0,o.PL)(a).then(function(e){e.forEach(function(e){let t=e.id;r.push(t)})}).catch(function(e){console.log("Error getting documents: ",e)}),await (0,o.PL)(n).then(function(e){e.forEach(function(e){let{docRef:t,email:n,requestedTime:a}=e.data(),o=e.id;r.includes(o)||i.push({docRef:t,email:n,requestedTime:a,docId:o})})}).catch(function(e){console.log("Error getting documents: ",e)}),i},y=async e=>{let t=(0,o.hJ)(c,"documentsToSign"),n=[],a=(0,o.IO)(t,(0,o.ar)("email","==",e),(0,o.ar)("signed","==",!0));return await (0,o.PL)(a).then(function(e){e.forEach(function(e){let{docRef:t,emails:a,signedTime:i}=e.data(),o=e.id;n.push({docRef:t,emails:a,signedTime:i,docId:o})})}).catch(function(e){console.log("Error getting documents: ",e)}),n}},1561:function(e,t,n){"use strict";n.d(t,{av:function(){return i},dy:function(){return o}});let a=(0,n(5667).oM)({name:"firebase",initialState:{user:null,docs:[],docsSigned:[]},reducers:{setUser:(e,t)=>{e.user=t.payload}}}),{setUser:i}=a.actions,o=e=>e.firebase.user;t.ZP=a.reducer},7579:function(e,t,n){"use strict";n.d(t,{El:function(){return i},En:function(){return r},K8:function(){return o}});let a=(0,n(5667).oM)({name:"assign",initialState:{signees:[]},reducers:{addSignee:(e,t)=>{e.signees=[...e.signees,{key:t.payload.key,name:t.payload.name,email:t.payload.email}]},resetSignee:(e,t)=>{console.log("resetSignee"),e.signees=[]}}}),{addSignee:i,resetSignee:o}=a.actions,r=e=>e.assign.signees;t.ZP=a.reducer},2495:function(e,t,n){"use strict";let a=(0,n(5667).oM)({name:"MergeAnnotation",initialState:{pdfNet:null},reducers:{setInstance:(e,t)=>{e.pdfNet=t.payload},resetInstance:(e,t)=>{e.pdfNet=null}}}),{setInstance:i,resetInstance:o}=a.actions;t.ZP=a.reducer},8718:function(e,t,n){"use strict";n.r(t);var a=n(7437),i=n(2265),o=n(4243);n(4752);var r=n(6017),s=n(7579),l=n(1563),d=n(1561),c=n(8378),u=n.n(c);n(2739),n(1871);var g=n(62),f=n(9376),p=n(9651);t.default=()=>{let[e,t]=(0,i.useState)(null),[n,c]=(0,i.useState)(null);(0,p.R)();let h=(0,o.I0)(),m=(0,f.useRouter)(),A=(0,o.v9)(s.En),x=A.map(e=>({value:e.email,label:e.name})),y=x.length>0?x[0].value:"",[w,v]=(0,i.useState)(y),b=(0,o.v9)(d.dy),{uid:D,email:E}=b,S=(0,i.useRef)(null),j=(0,i.useRef)(null);(0,i.useEffect)(()=>{u()({path:"/webviewer/lib",licenseKey:"demo:1729242579433:7e1e7d6e0300000000c0137aa39fab9df3e0a551e4c2572d4eed7df75c",initialDoc:"https://pdftron.s3.amazonaws.com/downloads/pl/demo-annotated.pdf",fullAPI:!0,disabledElements:["ribbons","toggleNotesButton","searchButton","menuButton"]},S.current).then(e=>{let{iframeWindow:n}=e.UI;e.UI.setToolbarGroup("toolbarGroup-View"),t(e);let a=n.document.body;a.addEventListener("dragover",N),a.addEventListener("drop",t=>{U(t,e)}),j.current.onchange=t=>{let n=t.target.files[0];n&&e.UI.loadDocument(n)}})},[]);let F=async()=>{let{Annotations:t,documentViewer:n}=e.Core,a=n.getAnnotationManager(),i=a.getFieldManager(),o=a.getAnnotationsList(),r=[],s=[];await Promise.all(o.map(async(e,n)=>{let o,l;if(void 0!==e.custom){if("TEXT"===e.custom.type)l=new t.Forms.Field(e.getContents()+Date.now()+n,{type:"Tx",value:e.custom.value}),o=new t.TextWidgetAnnotation(l);else if("SIGNATURE"===e.custom.type)l=new t.Forms.Field(e.getContents()+Date.now()+n,{type:"Sig"}),o=new t.SignatureWidgetAnnotation(l,{appearance:"_DEFAULT",appearances:{_DEFAULT:{Normal:{data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjEuMWMqnEsAAAANSURBVBhXY/j//z8DAAj8Av6IXwbgAAAAAElFTkSuQmCC",offset:{x:100,y:100}}}}});else if("DATE"===e.custom.type)l=new t.Forms.Field(e.getContents()+Date.now()+n,{type:"Tx",value:"m-d-yyyy",actions:{F:[{name:"JavaScript",javascript:'AFDate_FormatEx("mmm d, yyyy");'}],K:[{name:"JavaScript",javascript:'AFDate_FormatEx("mmm d, yyyy");'}]}}),o=new t.DatePickerWidgetAnnotation(l);else{a.deleteAnnotation(e,!1,!0);return}o.PageNumber=e.getPageNumber(),o.X=e.getX(),o.Y=e.getY(),o.rotation=e.Rotation,0===e.Rotation||180===e.Rotation?(o.Width=e.getWidth(),o.Height=e.getHeight()):(o.Width=e.getHeight(),o.Height=e.getWidth()),r.push(e),t.WidgetAnnotation.getCustomStyles=function(e){if(e instanceof t.SignatureWidgetAnnotation)return{border:"1px solid #a5c7ff"}},t.WidgetAnnotation.getCustomStyles(o),a.addAnnotation(o),i.addField(l),s.push(o)}})),a.deleteAnnotations(r,null,!0),await a.drawAnnotationsFromList(s),await C()},T=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:""),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},{documentViewer:o,Annotations:r}=e.Core,s=o.getAnnotationManager(),l=o.getDocument(),d=o.getDisplayModeManager().getDisplayMode(),c=d.getSelectedPages(n,n);if(n.x&&null==c.first)return;let u=null!==c.first?c.first:o.getCurrentPage(),g=l.getPageInfo(u),f=d.windowToPage(n,u),p=o.getZoomLevel();var h=new r.FreeTextAnnotation;h.PageNumber=u;let m=90*o.getCompleteRotation(u);h.Rotation=m,270===m||90===m?(h.Width=50/p,h.Height=250/p):(h.Width=250/p,h.Height=50/p),h.X=(f.x||g.width/2)-h.Width/2,h.Y=(f.y||g.height/2)-h.Height/2,h.setPadding(new r.Rect(0,0,0,0)),h.custom={type:t,value:a,flag:i,name:"".concat(w,"_").concat(t,"_")},h.setContents(h.custom.name),h.FontSize=""+20/p+"px",h.FillColor=new r.Color(211,211,211,.5),h.TextColor=new r.Color(0,165,228),h.StrokeThickness=1,h.StrokeColor=new r.Color(0,165,228),h.TextAlign="center",h.Author=s.getCurrentUser(),s.deselectAllAnnotations(),s.addAnnotation(h,!0),s.redrawAnnotation(h),s.selectAnnotation(h)},C=async()=>{let t=(0,g.cF)(),n=(0,g.iH)(t),a="docToSign/".concat(D).concat(Date.now(),".pdf");console.info(n);let i=(0,g.iH)(t,a),{documentViewer:o,annotationManager:r}=e.Core,d=o.getDocument(),c=await r.exportAnnotations({widgets:!0,fields:!0}),u=new Blob([new Uint8Array(await d.getFileData({xfdfString:c}))],{type:"application/pdf"});await (0,g.KV)(i,u).catch(e=>{console.log(e)}).then(function(e){console.log("Uploaded the blob")});let f=A.map(e=>e.email);await (0,l.N9)(D,E,a,f),h((0,s.K8)()),m.push("/")},N=e=>(e.preventDefault(),!1),U=(e,t)=>{let{docViewer:n}=t,a=n.getScrollViewElement(),i=a.scrollLeft||0,o=a.scrollTop||0;return c({x:e.pageX+i,y:e.pageY+o}),e.preventDefault(),!1},I=e=>{e.target.style.opacity=.5;let t=e.target.cloneNode(!0);t.id="form-build-drag-image-copy",t.style.width="250px",document.body.appendChild(t),e.dataTransfer.setDragImage(t,125,25),e.dataTransfer.setData("text","")},L=(e,t)=>{T(t,n),e.target.style.opacity=1,document.body.removeChild(document.getElementById("form-build-drag-image-copy")),e.preventDefault()};return b?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"prepareDocument",children:[(0,a.jsxs)(r.xu,{display:"flex",direction:"row",flex:"grow",children:[(0,a.jsxs)(r.sg,{span:2,children:[(0,a.jsx)(r.xu,{padding:3,children:(0,a.jsx)(r.X6,{size:"md",children:"Prepare Document"})}),(0,a.jsxs)(r.xu,{padding:3,children:[(0,a.jsx)("div",{className:"flex flex-row gap-1",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)(r.xv,{children:"Step 1"})}),(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)(r.zx,{onClick:()=>{j&&j.current.click()},accessibilityLabel:"upload a document",text:"Upload a document",iconEnd:"add-circle"})})]})}),(0,a.jsx)("div",{className:"flex flex-row",children:(0,a.jsxs)("div",{className:" grid ",children:[(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)(r.xv,{children:"Step 2"})}),(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)(r.EI,{id:"assigningFor",name:"assign",onChange:e=>{let{value:t}=e;return v(t)},options:x,placeholder:"Select recipient",label:"Adding signature for",value:w})}),(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)("div",{draggable:!0,onDragStart:e=>I(e),onDragEnd:e=>L(e,"SIGNATURE"),children:(0,a.jsx)(r.zx,{onClick:()=>T("SIGNATURE"),accessibilityLabel:"add signature",text:"Add signature",iconEnd:"compose"})})}),(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)("div",{draggable:!0,onDragStart:e=>I(e),onDragEnd:e=>L(e,"TEXT"),children:(0,a.jsx)(r.zx,{onClick:()=>T("TEXT"),accessibilityLabel:"add text",text:"Add text",iconEnd:"text-sentence-case"})})}),(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)("div",{draggable:!0,onDragStart:e=>I(e),onDragEnd:e=>L(e,"DATE"),children:(0,a.jsx)(r.zx,{onClick:()=>T("DATE"),accessibilityLabel:"add date field",text:"Add date",iconEnd:"calendar"})})})]})}),(0,a.jsx)("div",{className:"flex flex-row gap-1",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)(r.xv,{children:"Step 3"})}),(0,a.jsx)(r.xu,{padding:2,children:(0,a.jsx)(r.zx,{onClick:F,accessibilityLabel:"Send for signing",text:"Send",iconEnd:"send"})})]})})]})]}),(0,a.jsx)(r.sg,{span:10,children:(0,a.jsx)("div",{className:"webviewer",ref:S})})]}),(0,a.jsx)("input",{type:"file",ref:j,style:{display:"none"}})]}),"   "]}):(0,a.jsx)("div",{})}},1871:function(){}}]);