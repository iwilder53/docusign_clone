(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{1563:function(e,n,t){"use strict";t.d(n,{N9:function(){return p},auth:function(){return l},$2:function(){return w},HP:function(){return y},HY:function(){return x},qj:function(){return g},tO:function(){return d},u_:function(){return m}});var o=t(738),i=t(4752),c=t(5978),r=t(62);t(2495);let a=async(e,n)=>{try{let t=window.Core,o=window.Core.PDFNet;console.log(o),t.setWorkerPath("webviewer/lib/core");let i=d.ref(),c=await i.child(e).getDownloadURL(),r=async()=>{let t;let r=await o.PDFDoc.createFromURL(c);for(r.initSecurityHandler(),t=0;t<n.length;t++){console.log(n[t]);let e=await o.FDFDoc.createFromXFDF(n[t]);await r.fdfMerge(e),await r.flattenAnnotations()}let a=await r.saveMemoryBuffer(o.SDFDoc.SaveOptions.e_linearized),s=new Blob([a],{type:"application/pdf"});i.child(e).put(s).then(function(e){console.log("Uploaded the blob")})};await o.runWithCleanup(r)}catch(e){console.error(e)}},s=(0,o.ZF)({apiKey:"AIzaSyAyDmBFLsYmknmeNghLz-Xw2wLIQSMNr48",authDomain:"docusignclone.firebaseapp.com",projectId:"docusignclone",storageBucket:"docusignclone.appspot.com",messagingSenderId:"491807205117",appId:"1:491807205117:web:76f35b9931e73f4e134094"}),l=(0,i.v0)(s),u=(0,c.ad)(s),d=(0,r.cF)(s),f=new i.hJ,g=async()=>{await (0,i.rh)(l,f)},w=async(e,n)=>{if(!e)return;let t=(0,c.JU)(u,"users/".concat(e.uid));if(!(await (0,c.QT)(t)).exists){let{email:o,displayName:i,photoURL:c}=e;try{await t.set({displayName:i,email:o,photoURL:c,...n})}catch(e){console.error("Error creating user document",e)}}return h(e.uid)},h=async e=>{if(!e)return null;try{let n=(0,c.JU)(u,"users",l.currentUser.uid),t=await (0,c.QT)(n);return{uid:e,...t.data()}}catch(e){console.error("Error fetching user",e)}},p=async(e,n,t,o)=>{if(!e)return;let i=new Date,r=(0,c.JU)(u,"documentsToSign",t.split("/")[1]);(0,c.pl)(r,{uid:e,email:n,docRef:t,emails:o,xfdf:[],signedBy:[],signed:!1,requestedTime:i,signedTime:""}).then(function(e){console.log("Document written with ID: ",e)}).catch(function(e){console.error("Error adding document: ",e)})},m=async(e,n,t)=>{let o=(0,c.JU)(u,"documentsToSign",e);(0,c.QT)(o).then(async e=>{if(e.exists){let{signedBy:i,emails:r,xfdf:s,docRef:l}=e.data();if(!i.includes(n)){let e=[...i,n],u=[...s,t];if(await (0,c.r7)(o,{xfdf:u,signedBy:e}),e.length===r.length){let e=new Date;await (0,c.r7)(o,{signed:!0,signedTime:e}),a(l,u)}}}else console.log("No such document!")}).catch(function(e){console.log("Error getting document:",e)})},y=async e=>{let n=(0,c.hJ)(u,"documentsToSign"),t=(0,c.IO)(n,(0,c.ar)("emails","array-contains",e),(0,c.ar)("signed","==",!1)),o=(0,c.IO)(n,(0,c.ar)("signedBy","array-contains",e)),i=[],r=[];return await (0,c.PL)(o).then(function(e){e.forEach(function(e){let n=e.id;r.push(n)})}).catch(function(e){console.log("Error getting documents: ",e)}),await (0,c.PL)(t).then(function(e){e.forEach(function(e){let{docRef:n,email:t,requestedTime:o}=e.data(),c=e.id;r.includes(c)||i.push({docRef:n,email:t,requestedTime:o,docId:c})})}).catch(function(e){console.log("Error getting documents: ",e)}),i},x=async e=>{let n=(0,c.hJ)(u,"documentsToSign"),t=[],o=(0,c.IO)(n,(0,c.ar)("email","==",e),(0,c.ar)("signed","==",!0));return await (0,c.PL)(o).then(function(e){e.forEach(function(e){let{docRef:n,emails:o,signedTime:i}=e.data(),c=e.id;t.push({docRef:n,emails:o,signedTime:i,docId:c})})}).catch(function(e){console.log("Error getting documents: ",e)}),t}},2495:function(e,n,t){"use strict";let o=(0,t(5667).oM)({name:"MergeAnnotation",initialState:{pdfNet:null},reducers:{setInstance:(e,n)=>{e.pdfNet=n.payload},resetInstance:(e,n)=>{e.pdfNet=null}}}),{setInstance:i,resetInstance:c}=o.actions;n.ZP=o.reducer},6514:function(e,n,t){"use strict";t.r(n);var o=t(7437),i=t(2265),c=t(4243),r=t(6017),a=t(9563);t(1563);var s=t(8378),l=t.n(s);t(2739),t(8313);var u=t(9376),d=t(62);n.default=()=>{let e=(0,u.useRouter)(),[n,t]=(0,i.useState)(null),{docRef:s}=(0,c.v9)(a.Uq);console.info("document ref : ".concat(s));let f=(0,i.useRef)(null);(0,i.useEffect)(()=>{l()({path:"webviewer/lib",fullAPI:!0,disabledElements:["ribbons","toggleNotesButton","contextMenuPopup"]},f.current).then(async e=>{e.UI.setToolbarGroup("toolbarGroup-View"),t(e);let n=(0,d.cF)();await (0,d.Jt)((0,d.iH)(n,s)).then(n=>{console.info(n),e.Core.documentViewer.loadDocument(n)})})},[s]);let g=async()=>{e.push("/")};return(0,o.jsx)("div",{className:"prepareDocument",children:(0,o.jsxs)(r.xu,{display:"flex",direction:"row",flex:"grow",children:[(0,o.jsxs)(r.sg,{span:2,children:[(0,o.jsx)(r.xu,{padding:3,children:(0,o.jsx)(r.X6,{size:"md",children:"View Document"})}),(0,o.jsx)(r.xu,{padding:3,children:(0,o.jsx)(r.X2,{gap:1,children:(0,o.jsxs)(r.Kq,{children:[(0,o.jsx)(r.xu,{padding:2,children:(0,o.jsx)(r.zx,{onClick:()=>{n.UI.downloadPdf(!0)},accessibilityLabel:"download signed document",text:"Download",iconEnd:"download"})}),(0,o.jsx)(r.xu,{padding:2,children:(0,o.jsx)(r.zx,{onClick:g,accessibilityLabel:"complete signing",text:"Done viewing",iconEnd:"check"})})]})})})]}),(0,o.jsx)(r.sg,{span:10,children:(0,o.jsx)("div",{className:"webviewer",ref:f})})]})})}},9563:function(e,n,t){"use strict";t.d(n,{Sj:function(){return c},Uq:function(){return r},w5:function(){return i}});let o=(0,t(5667).oM)({name:"viewDoc",initialState:{docToView:null},reducers:{setDocToView:(e,n)=>{e.docToView=n.payload},resetDocToView:(e,n)=>{e.docToView=null}}}),{setDocToView:i,resetDocToView:c}=o.actions,r=e=>e.viewDoc.docToView;n.ZP=o.reducer},8313:function(){}}]);