(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53,56],{4032:function(e,n,t){Promise.resolve().then(t.bind(t,7713))},7713:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return f}});var i=t(7437),r=t(2265),s=t(4243),a=t(6017);t(2739);var c=t(7579),o=t(9376),l=()=>{let[e,n]=(0,r.useState)(""),[t,l]=(0,r.useState)(""),[u,d]=(0,r.useState)(!1),h=(0,s.v9)(c.En),f=(0,s.I0)(),g=(0,o.useRouter)(),x=(e,t)=>{let i="".concat(new Date().getTime()).concat(t);""!==e&&""!==t&&(f((0,c.El)({key:i,name:e,email:t})),n(""),l(""))};return(0,i.jsx)("div",{children:(0,i.jsx)(a.xu,{padding:3,children:(0,i.jsxs)(a.W2,{children:[(0,i.jsx)(a.xu,{padding:3,children:(0,i.jsx)(a.X6,{size:"md",children:"Who needs to sign?"})}),(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsx)(a.nv,{id:"displayName",onChange:e=>l(e.value),placeholder:"Enter recipient's name",label:"Name",value:t,type:"text"})}),(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsx)(a.nv,{id:"email",onChange:e=>n(e.value),placeholder:"Enter recipient's email",label:"Email",value:e,type:"email"})}),(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsx)(a.zx,{onClick:n=>{x(t,e)},text:"Add user",color:"blue",inline:!0})}),(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsxs)(a.iA,{children:[(0,i.jsx)(a.iA.Header,{children:(0,i.jsxs)(a.iA.Row,{children:[(0,i.jsx)(a.iA.HeaderCell,{children:(0,i.jsx)(a.xv,{weight:"bold",children:"Name"})}),(0,i.jsx)(a.iA.HeaderCell,{children:(0,i.jsx)(a.xv,{weight:"bold",children:"Email"})})]})}),(0,i.jsx)(a.iA.Body,{children:h.map(e=>(0,i.jsxs)(a.iA.Row,{children:[(0,i.jsx)(a.iA.Cell,{children:(0,i.jsx)(a.xv,{children:e.name})}),(0,i.jsx)(a.iA.Cell,{children:(0,i.jsx)(a.xv,{children:e.email})})]},e.key))})]})}),(0,i.jsx)(a.xu,{padding:2,children:(0,i.jsx)(a.zx,{onClick:()=>{h.length>0?g.push("/PrepareDocument"):(d(!0),setTimeout(()=>d(!1),1e3))},text:"Continue",color:"blue",inline:!0})}),(0,i.jsx)(a.xu,{fit:!0,dangerouslySetInlineStyle:{__style:{bottom:50,left:"50%",transform:"translateX(-50%)"}},paddingX:1,position:"fixed",children:u&&(0,i.jsx)(a.FN,{color:"red",text:(0,i.jsx)(i.Fragment,{children:"Please add at least one user"})})})]})})})},u=t(6056),d=()=>(0,i.jsxs)("div",{children:[(0,i.jsx)(u.default,{}),(0,i.jsx)(l,{})]}),h=t(9651),f=()=>(0,h.R)()&&(0,i.jsx)(d,{})},1563:function(e,n,t){"use strict";t.d(n,{N9:function(){return p},auth:function(){return l},$2:function(){return g},HP:function(){return j},HY:function(){return y},qj:function(){return f},tO:function(){return d},u_:function(){return m}});var i=t(738),r=t(4752),s=t(5978),a=t(62);t(2495);let c=async(e,n)=>{try{let t=window.Core,i=window.Core.PDFNet;console.log(i),t.setWorkerPath("webviewer/lib/core");let r=d.ref(),s=await r.child(e).getDownloadURL(),a=async()=>{let t;let a=await i.PDFDoc.createFromURL(s);for(a.initSecurityHandler(),t=0;t<n.length;t++){console.log(n[t]);let e=await i.FDFDoc.createFromXFDF(n[t]);await a.fdfMerge(e),await a.flattenAnnotations()}let c=await a.saveMemoryBuffer(i.SDFDoc.SaveOptions.e_linearized),o=new Blob([c],{type:"application/pdf"});r.child(e).put(o).then(function(e){console.log("Uploaded the blob")})};await i.runWithCleanup(a)}catch(e){console.error(e)}},o=(0,i.ZF)({apiKey:"AIzaSyAyDmBFLsYmknmeNghLz-Xw2wLIQSMNr48",authDomain:"docusignclone.firebaseapp.com",projectId:"docusignclone",storageBucket:"docusignclone.appspot.com",messagingSenderId:"491807205117",appId:"1:491807205117:web:76f35b9931e73f4e134094"}),l=(0,r.v0)(o),u=(0,s.ad)(o),d=(0,a.cF)(o),h=new r.hJ,f=async()=>{await (0,r.rh)(l,h)},g=async(e,n)=>{if(!e)return;let t=(0,s.JU)(u,"users/".concat(e.uid));if(!(await (0,s.QT)(t)).exists){let{email:i,displayName:r,photoURL:s}=e;try{await t.set({displayName:r,email:i,photoURL:s,...n})}catch(e){console.error("Error creating user document",e)}}return x(e.uid)},x=async e=>{if(!e)return null;try{let n=(0,s.JU)(u,"users",l.currentUser.uid),t=await (0,s.QT)(n);return{uid:e,...t.data()}}catch(e){console.error("Error fetching user",e)}},p=async(e,n,t,i)=>{if(!e)return;let r=new Date,a=(0,s.JU)(u,"documentsToSign",t.split("/")[1]);(0,s.pl)(a,{uid:e,email:n,docRef:t,emails:i,xfdf:[],signedBy:[],signed:!1,requestedTime:r,signedTime:""}).then(function(e){console.log("Document written with ID: ",e)}).catch(function(e){console.error("Error adding document: ",e)})},m=async(e,n,t)=>{let i=(0,s.JU)(u,"documentsToSign",e);(0,s.QT)(i).then(async e=>{if(e.exists){let{signedBy:r,emails:a,xfdf:o,docRef:l}=e.data();if(!r.includes(n)){let e=[...r,n],u=[...o,t];if(await (0,s.r7)(i,{xfdf:u,signedBy:e}),e.length===a.length){let e=new Date;await (0,s.r7)(i,{signed:!0,signedTime:e}),c(l,u)}}}else console.log("No such document!")}).catch(function(e){console.log("Error getting document:",e)})},j=async e=>{let n=(0,s.hJ)(u,"documentsToSign"),t=(0,s.IO)(n,(0,s.ar)("emails","array-contains",e),(0,s.ar)("signed","==",!1)),i=(0,s.IO)(n,(0,s.ar)("signedBy","array-contains",e)),r=[],a=[];return await (0,s.PL)(i).then(function(e){e.forEach(function(e){let n=e.id;a.push(n)})}).catch(function(e){console.log("Error getting documents: ",e)}),await (0,s.PL)(t).then(function(e){e.forEach(function(e){let{docRef:n,email:t,requestedTime:i}=e.data(),s=e.id;a.includes(s)||r.push({docRef:n,email:t,requestedTime:i,docId:s})})}).catch(function(e){console.log("Error getting documents: ",e)}),r},y=async e=>{let n=(0,s.hJ)(u,"documentsToSign"),t=[],i=(0,s.IO)(n,(0,s.ar)("email","==",e),(0,s.ar)("signed","==",!0));return await (0,s.PL)(i).then(function(e){e.forEach(function(e){let{docRef:n,emails:i,signedTime:r}=e.data(),s=e.id;t.push({docRef:n,emails:i,signedTime:r,docId:s})})}).catch(function(e){console.log("Error getting documents: ",e)}),t}},1561:function(e,n,t){"use strict";t.d(n,{av:function(){return r},dy:function(){return s}});let i=(0,t(5667).oM)({name:"firebase",initialState:{user:null,docs:[],docsSigned:[]},reducers:{setUser:(e,n)=>{e.user=n.payload}}}),{setUser:r}=i.actions,s=e=>e.firebase.user;n.ZP=i.reducer},9651:function(e,n,t){"use strict";t.d(n,{O:function(){return a},R:function(){return c}});var i=t(7437),r=t(2265);let s=(0,r.createContext)(!1),a=e=>{let{children:n}=e,[t,a]=(0,r.useState)(!1);return(0,r.useEffect)(()=>a(!0),[]),(0,i.jsx)(s.Provider,{value:t,children:n})};function c(){return(0,r.useContext)(s)}},7579:function(e,n,t){"use strict";t.d(n,{El:function(){return r},En:function(){return a},K8:function(){return s}});let i=(0,t(5667).oM)({name:"assign",initialState:{signees:[]},reducers:{addSignee:(e,n)=>{e.signees=[...e.signees,{key:n.payload.key,name:n.payload.name,email:n.payload.email}]},resetSignee:(e,n)=>{console.log("resetSignee"),e.signees=[]}}}),{addSignee:r,resetSignee:s}=i.actions,a=e=>e.assign.signees;n.ZP=i.reducer},2495:function(e,n,t){"use strict";let i=(0,t(5667).oM)({name:"MergeAnnotation",initialState:{pdfNet:null},reducers:{setInstance:(e,n)=>{e.pdfNet=n.payload},resetInstance:(e,n)=>{e.pdfNet=null}}}),{setInstance:r,resetInstance:s}=i.actions;n.ZP=i.reducer},6056:function(e,n,t){"use strict";t.r(n);var i=t(7437);t(2265);var r=t(6017);t(2739);var s=t(1563),a=t(4243),c=t(1561),o=t(7579);t(9431);var l=t(7648),u=t(9376);n.default=()=>{let e=(0,a.I0)(),n=s.auth.currentUser;console.info(n);let{displayName:t,photoURL:d,email:h}=n,f=(0,u.useRouter)();return(0,i.jsxs)(r.xu,{display:"flex",direction:"row",paddingY:2,color:"lightGray",children:[(0,i.jsx)(r.sg,{span:9,children:(0,i.jsx)(r.xu,{padding:3,children:(0,i.jsx)(l.default,{href:"/",className:"profileLink",children:(0,i.jsx)(r.X6,{size:"lg",children:"Fundasta Docs Sign"})})})}),(0,i.jsx)(r.sg,{span:3,children:(0,i.jsx)(r.xu,{padding:1,children:(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)(r.xu,{padding:1,children:(0,i.jsx)(r.qE,{name:t,size:"md",src:d})}),(0,i.jsxs)(r.xu,{children:[(0,i.jsx)(r.xv,{weight:"bold",children:t}),(0,i.jsx)(r.xv,{children:h})]}),(0,i.jsx)(r.xu,{padding:1,children:(0,i.jsx)(r.zx,{onClick:()=>{s.auth.signOut(),e((0,c.av)(null)),e((0,o.K8)()),f.push("/")},accessibilityLabel:"Sign out of your account",text:"Sign out"})})]})})})]})}},9431:function(){}},function(e){e.O(0,[224,405,525,358,533,667,360,243,648,971,117,744],function(){return e(e.s=4032)}),_N_E=e.O()}]);